{
  "version": "3.0",
  "customInstructions": [
    "遵循 'CLAUDE.md' 中的全感知任务管理模式 v3.0。",
    "核心原则1：收到 'START:' 指令时，必须先检查是否有production.md，如果有就参考，没有就基于项目结构创建",
    "核心原则2：收到 'START:' 指令时，检查完production.md之后，必须创建 schema/task_*.md，然后才能执行任务",
    "初始化：启动时必须检查 'production.md'，若不存在则执行 'ls -R' 并创建之。",
    "文档结构：任务文档必须包含：任务ID、创建时间、状态、最终目标、拆解步骤、当前进度及下一步行动。",
    "强制刷新：每一次回复的末尾必须包含【当前快照】代码块，包含项目状态、当前任务文件、目标、已完成项和下一步。",
    "错误恢复：若发现遗漏任务文档，必须立即停止当前工作，补齐文档后再继续。",
    "任务结项：收到 'DONE:' 后，更新 'production.md' 并将任务文件移至 'schema/archive/'。",
    "记忆对齐：会话重启后，优先读取 'production.md' 和最新的任务文档以恢复上下文。",
    "",
    "技术方案选择原则（CLAUDE.md 第7节）：",
    "- 优先选择通用化、可扩展的方案，避免 case-to-case 处理",
    "- 当多个场景相似时，必须提取共性，使用策略模式、配置驱动、工厂模式等通用方案",
    "- 方案评估优先级：通用性 > 可维护性 > 可测试性 > 性能 > 开发速度",
    "- 禁止使用长 if-elif-else 链、硬编码业务规则、为每个场景写独立函数",
    "- 提交代码前必须检查：是否处理了多个相似场景？是否已抽象为通用方案？",
    "",
    "测试要求规范（CLAUDE.md 第8节）：",
    "- 测试是代码的一部分，不是可选项。采用 TDD/BDD 方法：先写测试，后写实现",
    "- 单元测试覆盖率必须 ≥ 80%，核心业务逻辑 ≥ 90%",
    "- 必须同时编写单元测试和集成测试，遵循测试金字塔原则（70%单测 : 20%集成 : 10%E2E）",
    "- 单元测试要求：快速执行（<100ms）、独立、可重复、命名清晰（test_[函数]_[场景]_[期望]）",
    "- 集成测试要求：覆盖 API、数据库、关键业务流程，使用真实测试环境",
    "- 提交代码前必须确保：所有测试通过、覆盖率达标、边界条件和异常情况已测试",
    "- 禁止跳过测试、禁用测试、提交不通过测试的代码"
  ],
  "notAllowedPatterns": [
    "在收到 'START:' 没有检查production.md就执行后续操作",
    "在收到 'START:' 指令后未创建 'schema/task_[简码]_[YYMMDD]_[HHMMSS].md' 就开始执行代码",
    "在收到 'START:' 指令后仅使用 TodoWrite 而忽略 Markdown 任务文档的创建",
    "回复末尾缺少 [项目全局状态]、[当前任务文件] 等快照信息",
    "",
    "技术方案选择方面的禁止模式：",
    "- 使用长 if-elif-else 或 switch-case 链处理多个相似场景",
    "- 为每个用户类型/场景/版本编写特殊逻辑（case-to-case 处理）",
    "- 硬编码业务规则而不是使用配置",
    "- 复制粘贴代码进行修改而不是提取共性",
    "- 优先考虑开发速度而牺牲通用性和可维护性",
    "",
    "测试方面的禁止模式：",
    "- 提交代码时没有相应的单元测试或集成测试",
    "- 单元测试覆盖率低于 80%",
    "- 跳过测试执行（skip test）直接提交代码",
    "- 修改测试逻辑以适应实现（应该修改实现以适应测试）",
    "- 编写依赖执行顺序的测试",
    "- 将测试代码与生产代码混在一起",
    "- 只测试正常路径而不测试边界条件和异常情况"
  ],
  "tasks": {
    "initialize": {
      "description": "初始化项目状态和全局认知",
      "command": "ls -R && cat production.md"
    },
    "check_coverage": {
      "description": "检查测试覆盖率是否达标（≥80%）",
      "command": "pytest --cov=. --cov-report=term-missing"
    },
    "run_tests": {
      "description": "运行所有测试（单元测试 + 集成测试）",
      "command": "pytest -v"
    }
  }
}
